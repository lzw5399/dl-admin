pool:
  vmImage: "ubuntu-latest"

trigger:
  branches:
    include:
      - master
  paths:
    exclude:
      - dl-api-csharp/*
      - .gitignore
      - README.md

variables:
  - group: docker_hub_username_pwd # 引用变量组

  - name: applicationName
    value: dl-vue-admin

  - name: imageName
    value: "$(dockerid)/$(applicationName):latest"

  - name: workingDirectory
    value: $(applicationName)

steps:
  - task: Bash@3
    inputs:
      targetType: "inline"
      script: |
        echo hhh
        echo $(imageName)
        echo $(applicationName)

  - script: |
      npm install
      npm run build:prod
    workingDirectory: $(workingDirectory)
    displayName: "npm install and build"

  - script: docker build -f Dockerfile -t $(imageName) .
    workingDirectory: $(workingDirectory)
    displayName: "Docker build"

  - script: |
      docker login -u $(dockerid) -p $(password)
      docker push $(imageName)
    displayName: "Push docker image"
